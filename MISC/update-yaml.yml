#update-yaml
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: update-yaml
spec:
  params:  
  - name: yaml-path
  - name: appImage
  - name: buildRevision
  workspaces:
  - name: shared-workspace
  steps:
  - name: update-deploymwnt-image
    image: registry.redhat.io/openshift-pipelines/pipelines-git-init-rhel8@sha256:158b0fda662e5bc05e2ff46f6864a8620bbb45e1a2388a456de43aad6e72d8f7
    workingDir: "$(workspaces.source.path)/$(params.yaml-path)"
    script: |
      #!/usr/bin/env sh
      set -e

      echo "updating $(inputs.params.yaml-path) image to $(inputs.params.appImage):$(inputs.params.buildRevision)"
      sed -i "s#$(inputs.params.appImage):[a-zA-Z0-9]\\+#$(inputs.params.appImage):$(inputs.params.buildRevision)#" deployment.yaml
